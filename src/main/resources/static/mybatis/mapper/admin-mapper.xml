<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
	<select id="AdminBoard" resultType="BoardDTO">
		select ib.BOARD_NO, ib.BOARD_BF_NO, ib.BOARD_ANS_NO,
		ib.BOARD_TITLE, ib.BOARD_CONTENT, ib.BOARD_DATE, u.NAME,
		ib.ANS_YN, ib.DEL_YN
		from Inq_Board ib
		join `USER` u
		where ib.BOARD_USER = u.USER_NO
		<!-- and ib.DEL_YN = '1' -->
		order by ib.BOARD_DATE DESC, ib.BOARD_NO DESC
	</select>

	<select id="AdminUser" resultType="userDTO">
		SELECT *
		FROM USER
	</select>

	<update id="updateBoardDel" parameterType="BoardDTO">
		update Inq_Board set
		DEL_YN = #{del_yn}
		where BOARD_NO = #{board_no}
	</update>

	<update id="userUpdate" parameterType="userDTO">
		UPDATE USER SET ROLE =
		#{role}
		WHERE USER_NO = #{user_no}
	</update>

	<update id="answerNumberUpdate" parameterType="BoardDTO">
		update Inq_Board set ANS_YN = "2", BOARD_ANS_NO = #{board_ans_no}
		<!-- (ANS_YN, BOARD_ANS_NO) = ("2", #{board_ans_no}) -->
		where BOARD_NO = #{board_no};
	</update>

	<select id="getAnswerContent" parameterType="Integer"
		resultType="String">
		select BOARD_CONTENT from Inq_Board
		where BOARD_BF_NO = #{board_no}
	</select>

	<insert id="answerPostInsert" parameterType="BoardDTO">
		<!-- Insert query -->
		insert into Inq_Board (BOARD_BF_NO, BOARD_USER, BOARD_TITLE, BOARD_CONTENT, ANS_YN)
		values (#{board_no}, (select USER_NO from USER where USERNAME = #{name}),
		#{board_title}, #{board_content}, '4');
		<!-- Select the last inserted ID -->
		<selectKey resultType="Integer" keyProperty="board_ans_no" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>

	<update id="answerPostUpdate" parameterType="BoardDTO">
		<!-- Update query -->
		update Inq_Board set BOARD_CONTENT = #{board_content}
		where BOARD_BF_NO = #{board_no}
	</update>

	<select id="getAnsYn" resultType="String" parameterType="BoardDTO">
		select ANS_YN from Inq_Board where BOARD_NO = #{board_no}
	</select>
</mapper>